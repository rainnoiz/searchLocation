<!DOCTYPE html>
<html>
<head>
    <title>Compare Location</title>
    <!--Theme JQuery-->
    <link href="Script/jquery-ui-1.10.3.custom/development-bundle/themes/base/jquery-ui.css" rel="stylesheet" />
    <script src="Script/jquery-ui-1.10.3.custom/js/jquery-1.9.1.js"></script>
    <script src="Script/jquery-ui-1.10.3.custom/js/jquery-ui-1.10.3.custom.js"></script>

    <!--appendGrid-->
    <link href="Plugin/appendGrid/jquery.appendGrid-1.3.1.css" rel="stylesheet" />
    <script src="Plugin/appendGrid/jquery.appendGrid-1.3.1.js"></script>

    <!--Google Map API-->
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
   

    <!-- CSS -->
    <link href="CSS/StyleSheet.css" rel="stylesheet" />


    <script>//Google Map API
        var map;
        var markersLoc = [];
        var markersSup = [];
        var markersCus = [];
        var markerLocation;
        var directionsDisplay;
        //var directionsService = new google.maps.DirectionsService();
        //var directionsService = new Array();

        function initialize() {
            directionsDisplay = new google.maps.DirectionsRenderer();
            //directionsDisplay2 = new google.maps.DirectionsRenderer();

            var location = new google.maps.LatLng(13.75, 100.517);
            var mapOptions = {
                zoom: 6,
                center: location,
                draggable: true,
                animation: google.maps.Animation.DROP

            }
            map = new google.maps.Map(document.getElementById('map-canvas'),
                mapOptions);
            directionsDisplay.setMap(map);
            //directionsDisplay2.setMap(map);
        }

        /*Add a marker to the map and push to the array.*/
        function AddMarkersLoc() {
            var location = new google.maps.LatLng(13.75, 100.517);
            var markerLoc = new google.maps.Marker({
                position: location,
                map: map,
                draggable: true,
                animation: google.maps.Animation.DROP,
                icon: 'Image/iconStar.png',
                myID: markersLoc.length,
                locName: ""
            });
            markersLoc.push(markerLoc);
            var rowIndex = $('#gridLocation').appendGrid('getRowIndex', markersLoc.length);
            google.maps.event.addListener(markerLoc, 'position_changed', function () {
                var path = markerLoc.getPosition();
                var splitLatLongLoc = path.toString().substring(1, (path.toString().length - 1)).split(',');
                $('#gridLocation').appendGrid('setCtrlValue', 'locLat', rowIndex, Math.floor((parseFloat(splitLatLongLoc[0])) * 100000) / 100000);
                $('#gridLocation').appendGrid('setCtrlValue', 'locLon', rowIndex, Math.floor((parseFloat(splitLatLongLoc[1])) * 100000) / 100000);
            });

            google.maps.event.addListener(markerLoc, 'click', function () {
                var info = $('#gridLocation').appendGrid('getCtrlValue', 'locName', rowIndex);
                var infoWindow = new google.maps.InfoWindow({
                    content: info
                });
                infoWindow.open(map, markerLoc);
            });
        }

        function AddMarkersSup() {
            //var markerSup = {};
            var location = new google.maps.LatLng(13.75, 100.517);
            var markerSup = new google.maps.Marker({
                position: location,
                map: map,
                draggable: true,
                animation: google.maps.Animation.DROP,
                icon: 'Image/iconBlue.png',
                myID: markersSup.length,
                supName: ""
            });
            markersSup.push(markerSup);
            var rowIndex = $('#gridSupplier').appendGrid('getRowIndex', markersSup.length);
            google.maps.event.addListener(markerSup, 'position_changed', function () {
                var path = markerSup.getPosition();
                var splitLatLongSup = path.toString().substring(1, (path.toString().length - 1)).split(',');
                //$('#gridSupplier').appendGrid('setCtrlValue', 'supLocation', rowIndex, Math.floor((parseFloat(splitLatLongSup[0])) * 100000) / 100000 + ", " + Math.floor((parseFloat(splitLatLongSup[1])) * 100000) / 100000);
                $('#gridSupplier').appendGrid('setCtrlValue', 'supLat', rowIndex, Math.floor((parseFloat(splitLatLongSup[0])) * 100000) / 100000);
                $('#gridSupplier').appendGrid('setCtrlValue', 'supLon', rowIndex, Math.floor((parseFloat(splitLatLongSup[1])) * 100000) / 100000);
            });

            google.maps.event.addListener(markerSup, 'click', function () {
                var info = $('#gridSupplier').appendGrid('getCtrlValue', 'supName', rowIndex);
                var infoWindow = new google.maps.InfoWindow({
                    content: info
                });
                infoWindow.open(map, markerSup);
            });
        }

        function AddMarkersCus() {
            var location = new google.maps.LatLng(13.75, 100.517);
            var markerCus = new google.maps.Marker({
                position: location,
                map: map,
                draggable: true,
                animation: google.maps.Animation.DROP,
                icon: 'Image/iconPink.png',
                myID: markersCus.length,
                cusName: ""
            });

            markersCus.push(markerCus);
            var rowIndex = $('#gridCustomer').appendGrid('getRowIndex', markersCus.length);
            google.maps.event.addListener(markerCus, 'position_changed', function () {
                var path = markerCus.getPosition();
                var splitLatLongCus = path.toString().substring(1, (path.toString().length - 1)).split(',');
                //$('#gridCustomer').appendGrid('setCtrlValue', 'cusLocation', rowIndex, Math.floor((parseFloat(splitLatLongCus[0])) * 100000) / 100000 + ", " + Math.floor((parseFloat(splitLatLongCus[1])) * 100000) / 100000);
                $('#gridCustomer').appendGrid('setCtrlValue', 'cusLat', rowIndex, Math.floor((parseFloat(splitLatLongCus[0])) * 100000) / 100000);
                $('#gridCustomer').appendGrid('setCtrlValue', 'cusLon', rowIndex, Math.floor((parseFloat(splitLatLongCus[1])) * 100000) / 100000);

            });

            google.maps.event.addListener(markerCus, 'click', function () {
                var info = $('#gridCustomer').appendGrid('getCtrlValue', 'cusName', rowIndex);
                var infoWindow = new google.maps.InfoWindow({
                    content: info
                });
                infoWindow.open(map, markerCus);
            });
        }

        /*Delete all markers*/
        function DeleteAllMarkers() {            
            //Delete markers
            for (var i = 0; i < markersSup.length; i++) {
                markersSup[i].setMap(null);
            }
            for (var i = 0; i < markersCus.length; i++) {
                markersCus[i].setMap(null);
            }
            for (var i = 0; i < markersLoc.length; i++) {
                markersLoc[i].setMap(null);
            }

            //Delete row
            DeleteAllRows();
        }

        /*Delete row location*/
        function DeleteMapLoc(id) {
            markersLoc[id].setMap(null);
        }

        /*Delete row supplier*/
        function DeleteMapSup(id) {
            markersSup[id].setMap(null);
        }

        /*Delete row customer*/
        function DeleteMapCus(id) {
            markersCus[id].setMap(null);
        }

        /* Dragable marker */
        function toggleBounce() {

            if (markers.getAnimation() != null) {
                markers.setAnimation(null);
            } else {
                marker.setAnimation(google.maps.Animation.BOUNCE);
            }
        }

        /*Show infomation window*/
        function mapInfoLoc(id, info) {
            var infoWindow = new google.maps.InfoWindow({
                content: info
            });
            infoWindow.open(map, markersLoc[id]);
        }

        function mapInfoSup(id, info) {
            var infoWindow = new google.maps.InfoWindow({
                content: info
            });
            infoWindow.open(map, markersSup[id]);
        }

        function mapInfoCus(id, info) {
            var infoWindow = new google.maps.InfoWindow({
                content: info
            });
            infoWindow.open(map, markersCus[id]);
        }

        function CreateLocationMark(lat, lan) {
            if (markerLocation) {
                markerLocation.setMap(null);
                markerLocation = null;

            }
            var location = new google.maps.LatLng(lat, lan);
            markerLocation = new google.maps.Marker({
                position: location,
                map: map,
                animation: google.maps.Animation.DROP,
                icon: 'Image/iconOrange.png',
            });
            var infoWindow = new google.maps.InfoWindow({
                content: lat + ", " + lan
            });
            infoWindow.open(map, markerLocation);
        }

        /*Calculate distance*/
        function findDistance() {
            allLocations = new Array();
            var value = "";
            var checkValue;
            var resultCheckValue = true;
            var regLatLon = new RegExp('^\\d+(\.\\d+)?$');
            var regCostQuan = new RegExp('^$|^\\d+$');

            //Location
            var dataLoc = $('#gridLocation').appendGrid('getAllValue');
            var iLoc = 0;
            var checkValue;
            var dataLocLat = new Array();

            for (iLoc = 0; iLoc < dataLoc.length; iLoc++) {
                value = ($('#gridLocation').appendGrid('getAllValue'))[iLoc].locLat.toString()
                checkValue = regLatLon.test(value);
                if (checkValue) {
                    dataLocLat[iLoc] = value;
                } else { resultCheckValue = false; }
            }

            iLoc = 0;
            var dataLocLon = new Array();
            for (iLoc = 0; iLoc < dataLoc.length; iLoc++) {
                value = ($('#gridLocation').appendGrid('getAllValue'))[iLoc].locLon.toString();
                checkValue = regLatLon.test(value);
                if (checkValue) {
                    dataLocLon[iLoc] = value;
                } else { resultCheckValue = false; }
            }

            //Supplier
            var dataSup = $('#gridSupplier').appendGrid('getAllValue');
            var dataSupLat = new Array();
            var dataSupLon = new Array();
            var dataSupCost = new Array();
            var dataSupQuan = new Array();
            for (var iSup = 0; iSup < dataSup.length; iSup++) {
                //validate lat/lon
                value = ($('#gridSupplier').appendGrid('getAllValue'))[iSup].supLat.toString();
                checkValue = regLatLon.test(value);
                if (checkValue) {
                    dataSupLat[iSup] = value;
                } else { resultCheckValue = false; }
                value = ($('#gridSupplier').appendGrid('getAllValue'))[iSup].supLon.toString();
                checkValue = regLatLon.test(value);
                if (checkValue) {
                    dataSupLon[iSup] = value;
                } else { resultCheckValue = false; }

                //validate cost/quantities
                value = ($('#gridSupplier').appendGrid('getAllValue'))[iSup].supCost.toString();
                checkValue = regCostQuan.test(value);
                if (checkValue) {
                    if (value == "0" || value == "") {
                        dataSupCost[iSup] = "1";
                    }
                    else {
                        dataSupCost[iSup] = value;
                    }
                } else { resultCheckValue = false; }
                value = ($('#gridSupplier').appendGrid('getAllValue'))[iSup].supQuantity.toString();
                checkValue = regCostQuan.test(value);
                if (checkValue) {
                    if (value == "0" || value == "") {
                        dataSupQuan[iSup] = "1";
                    }
                    else {
                        dataSupQuan[iSup] = value;
                    }
                } else { resultCheckValue = false; }
            }

            //Customer
            var dataCus = $('#gridCustomer').appendGrid('getAllValue');
            var dataCusLat = new Array();
            var dataCusLon = new Array();
            var dataCusCost = new Array();
            var dataCusQuan = new Array();
            for (var iCus = 0; iCus < dataCus.length; iCus++) {
                //validate lat/lon
                value = ($('#gridCustomer').appendGrid('getAllValue'))[iCus].cusLat.toString();
                checkValue = regLatLon.test(value);
                if (checkValue) {
                    dataCusLat[iCus] = value;
                } else { resultCheckValue = false; }
                value = ($('#gridCustomer').appendGrid('getAllValue'))[iCus].cusLon.toString();
                checkValue = regLatLon.test(value);
                if (checkValue) {
                    dataCusLon[iCus] = value;
                } else { resultCheckValue = false; }

                //validate cost/quantities
                value = ($('#gridCustomer').appendGrid('getAllValue'))[iCus].cusCost.toString();
                checkValue = regCostQuan.test(value);
                if (checkValue) {
                    if (value == "0" || value == "") {
                        dataCusCost[iCus] = "1";
                    }
                    else {
                        dataCusCost[iCus] = value;
                    }
                } else { resultCheckValue = false; }
                value = ($('#gridCustomer').appendGrid('getAllValue'))[iCus].cusQuantity.toString();
                checkValue = regCostQuan.test(value);
                if (checkValue) {
                    if (value == "0" || value == "") {
                        dataCusQuan[iCus] = "1";
                    }
                    else {
                        dataCusQuan[iCus] = value;
                    }
                } else { resultCheckValue = false; }
            }

            //ตรวจสอบค่า
            //for (i = 0; i < dataLocLon.length; i++)
            //{
            //    alert("dataLocLat:" + dataLocLat[i] + " dataLocLon:" + dataLocLon[i]);
            //}
            //for (i = 0; i < dataSupLat.length; i++) {
            //    alert("dataSupCost:" + dataSupCost[i] + " dataSupQuan:" + dataSupQuan[i] +
            //        "dataSupLat:" + dataSupLat[i] + " dataSupLon:" + dataSupLon[i]);
            //}
            //for (i = 0; i < dataCusLat.length; i++) {
            //    alert("dataCusCost:" + dataCusCost[i] + " dataCusQuan:" + dataCusQuan[i] +
            //        "dataCusLat:" + dataCusLat[i] + " dataCusLon:" + dataCusLon[i]);
            //}

            if (resultCheckValue) {
                //Calculate
                var start = new Array();
                var end = new Array();
                var endSup = new Array();
                var endCus = new Array();

                for (var i = 0; i < dataLocLat.length; i++) {
                    start[i] = dataLocLat[i] + ", " + dataLocLon[i];
                }
                for (var i = 0; i < dataSupLat.length; i++) {
                    endSup[i] = dataSupLat[i] + ", " + dataSupLon[i];
                }
                for (var i = 0; i < dataCusLat.length; i++) {
                    endCus[i] = dataCusLat[i] + ", " + dataCusLon[i];
                }
                end = endSup.concat(endCus); //Merge array

                var request = new Array();
                var iReq = 0;
                for (var i = 0; i < start.length; i++) {
                    for (var j = 0; j < end.length; j++) {
                        request[iReq] = {
                            origin: start[i],
                            destination: end[j],
                            //provideRouteAlternatives: true,
                            travelMode: google.maps.TravelMode.DRIVING
                        };
                        iReq++;
                    }
                }
                //Calculate distance
                CalculateDistances(start, end, request);

            } else { alert("กรุณาระบุ ต้นทุน(Cost) / ปริมาณ(Quantities) / พิกัดละติจูน / พิกัดลองจิจูด เป็นตัวเลขหรือไม่ระบุ"); } 
        }

        var directionsService; //= new Array();
        function CalculateDistances(start, end, request) {
            var totalDistance = 0;
            var inputEnd = end.length;
            var inputStart = 0;
            var a = 0;
            for (var i = 0; i < request.length; i++) {
                directionsService = new google.maps.DirectionsService();
                directionsService.route(request[i], function (response, status) {
                    if (status == google.maps.DirectionsStatus.OK) {
                        totalDistance += response.routes[0].legs[0].distance.value;
                        inputEnd--;
                    }
                    if (inputEnd == 0) {
                        finishCalculateDistances(inputStart, totalDistance);
                        inputEnd = end.length;
                        inputStart++;
                        totalDistance = 0;
                    }
                });
            }
        }

        var allLocations;
        function finishCalculateDistances(inputStart,totalDistance) {
            //alert("finish: "+totalDistance);
            allLocations[inputStart] = totalDistance;
            for (var i = 0; i < allLocations.length; i++) {
                alert(allLocations[i] + "i: " + i);
            }
        }

        google.maps.event.addDomListener(window, 'load', initialize);

    </script>

    <script>//Button
        $(function () {
            $("button")
            .button()
            .click(function (event) {
                event.preventDefault();
            });
        });
    </script>

    <script>
        /* appendGrid */
        jQuery(document).ready(function ($) {
            $(function () {

                /*Location*/
                $('#gridLocation').appendGrid({
                    initRows: 0,
                    columns: [
                    {
                        name: 'locName', display: 'ชื่อสถานที่ตั้ง', type: 'text', ctrlAttr: { maxlength: 200 }, displayCss: { width: '50%' },
                        onChange: function (evt, rowIndex) /*Have a change in this cell go to show mapInfo on marker*/ {
                            var id = $('#gridLocation').appendGrid('getUniqueIndex', rowIndex);
                            var info = $('#gridLocation').appendGrid('getCtrlValue', 'locName', rowIndex);
                            mapInfoLoc(id - 1, info);
                        }
                    },
                    { name: 'locLat', display: 'พิกัดละติจูด', type: 'text', ctrlAttr: { maxlength: 100 }, displayCss: { width: '25%' } },
                    { name: 'locLon', display: 'พิกัดลองจิจูด', type: 'text', ctrlAttr: { maxlength: 100 }, displayCss: { width: '25%' } },
                    { name: 'locationRecordId', type: 'hidden', value: 0 }
                    ],
                    customRowButtons: [
                        {
                            uiButton: { icons: { primary: 'ui-icon-trash' } },
                            click: function (evtObj, uniqueIndex, rowData) {
                                DeleteRowLoc(uniqueIndex);
                                DeleteMapLoc(uniqueIndex - 1);
                            }
                        }
                    ],
                    customFooterButtons: [
                        {
                            uiButton: { icons: { primary: 'ui-icon-plusthick' } },
                            btnCss: { 'color': '#ff0000' },
                            btnClass: 'append',
                            click: function (evt) {
                                InsertRow(0);
                            },
                            atTheFront: true
                        }
                    ],
                    caption: null,
                    hideRowNumColumn: true,
                    hideButtons: {
                        moveUp: true,
                        moveDown: true,
                        insert: true,
                        remove: true,
                        removeLast: true,
                        append: true
                    }
                });

                /*Supplier*/
                $('#gridSupplier').appendGrid({
                    initRows: 0,
                    columns: [
                    {
                        name: 'supName', display: 'ชื่อคู่ค้า', type: 'text', ctrlAttr: { maxlength: 200 }, displayCss: { width: '30%' },
                        onChange: function (evt, rowIndex) /*Have a change in this cell go to show mapInfo on marker*/ {
                            var id = $('#gridSupplier').appendGrid('getUniqueIndex', rowIndex);
                            var info = $('#gridSupplier').appendGrid('getCtrlValue', 'supName', rowIndex);
                            mapInfoSup(id - 1, info);
                        }
                    },
                    { name: 'supCost', display: 'ต้นทุน', type: 'text', ctrlAttr: { maxlength: 100 }, displayCss: { width: '15%' } },
                    { name: 'supQuantity', display: 'ปริมาณ', type: 'text', ctrlAttr: { maxlength: 100 }, displayCss: { width: '15%' } },
                    //{ name: 'supLocation', display: 'Location', type: 'text', ctrlAttr: { maxlength: 100 }, displayCss: { width: '40%' } },
                    { name: 'supLat', display: 'พิกัดละติจูด', type: 'text', ctrlAttr: { maxlength: 100 }, displayCss: { width: '20%' } },
                    { name: 'supLon', display: 'พิกัดลองจิจูด', type: 'text', ctrlAttr: { maxlength: 100 }, displayCss: { width: '20%' } },
                    { name: 'supRecordId', type: 'hidden', value: 0 }
                    ],
                    customRowButtons: [
                        {
                            uiButton: { icons: { primary: 'ui-icon-trash' } },
                            click: function (evtObj, uniqueIndex, rowData) {
                                DeleteRowSup(uniqueIndex);
                                DeleteMapSup(uniqueIndex - 1);
                            }
                        }
                    ],
                    customFooterButtons: [
                        {
                            uiButton: { icons: { primary: 'ui-icon-plusthick' } },
                            btnCss: { 'color': '#ff0000' },
                            btnClass: 'append',
                            click: function (evt) {
                                InsertRow(1);
                            },
                            atTheFront: true
                        }
                    ],
                    caption: null,
                    hideRowNumColumn: true,
                    hideButtons: {
                        moveUp: true,
                        moveDown: true,
                        insert: true,
                        remove: true,
                        removeLast: true,
                        append: true
                    }
                });

                /*Customer*/
                $('#gridCustomer').appendGrid({
                    initRows: 0,
                    columns: [
                    {
                        name: 'cusName', display: 'ชื่อลูกค้า', type: 'text', ctrlAttr: { maxlength: 200 }, displayCss: { width: '30%' },
                        onChange: function (evt, rowIndex) /*Have a change in this cell go to show mapInfo on marker*/ {
                            var id = $('#gridCustomer').appendGrid('getUniqueIndex', rowIndex);
                            var info = $('#gridCustomer').appendGrid('getCtrlValue', 'cusName', rowIndex);
                            mapInfoCus(id - 1, info);
                        }
                    },
                    { name: 'cusCost', display: 'ต้นทุน', type: 'text', ctrlAttr: { maxlength: 100 }, displayCss: { width: '15%' } },
                    { name: 'cusQuantity', display: 'ปริมาณ', type: 'text', ctrlAttr: { maxlength: 100 }, displayCss: { width: '15%' } },
                    //{ name: 'cusLocation', display: 'Location', type: 'text', ctrlAttr: { maxlength: 100 }, displayCss: { width: '40%' } },
                    { name: 'cusLat', display: 'พิกัดละติจูด', type: 'text', ctrlAttr: { maxlength: 100 }, displayCss: { width: '20%' } },
                    { name: 'cusLon', display: 'พิกัดลองจิจูด', type: 'text', ctrlAttr: { maxlength: 100 }, displayCss: { width: '20%' } },
                    { name: 'cusRecordId', type: 'hidden', value: 0 }
                    ],
                    customRowButtons: [
                            {
                                uiButton: { icons: { primary: 'ui-icon-trash' } },
                                click: function (evtObj, uniqueIndex, rowData) {
                                    DeleteRowCus(uniqueIndex);
                                    DeleteMapCus(uniqueIndex - 1);
                                }
                            }
                    ],
                    customFooterButtons: [
                        {
                            uiButton: { icons: { primary: 'ui-icon-plusthick' } },
                            btnCss: { 'color': '#ff0000' },
                            btnClass: 'append',
                            click: function (evt) {
                                InsertRow(2);
                            },
                            atTheFront: true
                        }
                    ],
                    caption: null,
                    hideRowNumColumn: true,
                    hideButtons: {
                        moveUp: true,
                        moveDown: true,
                        insert: true,
                        remove: true,
                        removeLast: true,
                        append: true
                    }
                });
            });
        });
    </script>

    <script type="text/javascript">
        /*Check LatLon supplier*/
        function CheckFindLocation() {
            var dataLocChk = $('#gridLocation').appendGrid('getAllValue');
            var dataSup = $('#gridSupplier').appendGrid('getAllValue');
            var dataCus = $('#gridCustomer').appendGrid('getAllValue');
            if ((dataLocChk.length > 0) && (dataSup.length > 0 || dataCus.length > 0)) {
                findDistance();
            }
            else { alert("กรุณาระบุข้อมูล สถานที่ตั้ง(Location) / คู่ค้า(Supplier) หรือ ลูกค้า(Customer)");}
        }

        /*
        /*Calculate location
        function FindLocation() {
            var checkValue;
            var resultCheckValue = true;

            //Supplier
            var dataSup = $('#gridSupplier').appendGrid('getAllValue');
            var i = 0;
            var reg = new RegExp('^$|^\\d+$');

            var dataSupCosts = new Array();
            for (i = 0; i < dataSup.length; i++) {
                checkValue = reg.test(($('#gridSupplier').appendGrid('getAllValue'))[i].supCost.toString());
                if (checkValue) {
                    if (checkValue == "0" || checkValue == "") {
                        dataSupCosts[i] = "1";
                    }
                    else {
                        dataSupCosts[i] = checkValue;
                    }
                } else { resultCheckValue = false; }

            }
            var dataSupQuan = new Array();
            for (i = 0; i < dataSup.length; i++) {
                checkValue = reg.test(($('#gridSupplier').appendGrid('getAllValue'))[i].supQuantity.toString());
                if (checkValue) {
                    if (checkValue == "0" || checkValue == "") {
                        dataSupQuan[i] = "1";
                    }
                    else {
                        dataSupQuan[i] = checkValue;
                    }
                } else { resultCheckValue = false; }
            }
            var dataSupLat = new Array();
            var dataSupLon = new Array();
            for (i = 0; i < dataSup.length; i++) {
                var dataSupLocations = ($('#gridSupplier').appendGrid('getAllValue'))[i].supLocation.toString();
                var dataSupLocation = dataSupLocations.split(",");
                dataSupLat[i] = dataSupLocation[0];
                dataSupLon[i] = dataSupLocation[1];
            }

            //Customer
            var dataCus = $('#gridCustomer').appendGrid('getAllValue');
            var i = 0;
            var dataCusCosts = new Array();
            for (i = 0; i < dataCus.length; i++) {
                checkValue = reg.test(($('#gridCustomer').appendGrid('getAllValue'))[i].cusCost.toString());
                if (checkValue) {
                    if (checkValue == "0" || checkValue == "") {
                        dataCusCosts[i] = "1";
                    }
                    else {
                        dataCusCosts[i] = checkValue;
                    }
                } else { resultCheckValue = false; }
            }
            var dataCusQuan = new Array();
            for (i = 0; i < dataCus.length; i++) {
                checkValue = reg.test(($('#gridCustomer').appendGrid('getAllValue'))[i].cusQuantity.toString());
                if (checkValue) {
                    if (checkValue == "0" || checkValue == "") {
                        dataCusQuan[i] = "1";
                    }
                    else {
                        dataCusQuan[i] = checkValue;
                    }
                } else { resultCheckValue = false; }
            }
            var dataCusLat = new Array();
            var dataCusLan = new Array();
            for (i = 0; i < dataCus.length; i++) {
                var dataCusLocations = ($('#gridCustomer').appendGrid('getAllValue'))[i].cusLocation.toString();
                var dataCusLocation = dataCusLocations.split(",");
                dataCusLat[i] = dataCusLocation[0];
                dataCusLan[i] = dataCusLocation[1];
            }
            if (resultCheckValue) {
                CalculateLocation(dataSubCosts, dataSubQuan, dataSubLat, dataSubLan,
                                    dataCusCosts, dataCusQuan, dataCusLat, dataCusLan);
            }
            else { alert("กรุณาระบุ ต้นทุน(Cost) และปริมาณ(Quantities) เป็นตัวเลขหรือไม่ระบุเท่านั้น"); }
        }
        */

        /*Calculate Location*/
        function CalculateLocation(dataSubCosts, dataSubQuan, dataSubLat, dataSubLan,
                                dataCusCosts, dataCusQuan, dataCusLat, dataCusLan) {
            var horizontalSup = 0, verticalSup = 0, horizontalCus = 0, verticalCus = 0, costQuanSup = 0, costQuanCus = 0;
            var horizontal, vertical, costQuan;
            var locationLat, locationLan;
            var rowCountSup = $('#gridSupplier').appendGrid('getRowCount');
            var rowCountCus = $('#gridCustomer').appendGrid('getRowCount');
            var j;
            for (j = 0; j < rowCountSup; j++) {
                horizontalSup += (dataSupCosts[j] * dataSupQuan[j] * dataSupLat[j]);
                verticalSup += (dataSupCosts[j] * dataSupQuan[j] * dataSupLon[j]);
                costQuanSup += dataSupCosts[j] * dataSupQuan[j];
            }

            for (j = 0; j < rowCountCus; j++) {
                horizontalCus += (dataCusCosts[j] * dataCusQuan[j] * dataCusLat[j]);
                verticalCus += (dataCusCosts[j] * dataCusQuan[j] * dataCusLan[j]);
                costQuanCus += dataCusCosts[j] * dataCusQuan[j];
            }
            horizontal = horizontalSup + horizontalCus;
            vertical = verticalSup + verticalCus;
            costQuan = costQuanSup + costQuanCus;
            locationLat = horizontal / costQuan;
            locationLan = vertical / costQuan;

            CreateLocationMark(Math.floor((parseFloat(locationLat)) * 100000) / 100000, Math.floor((parseFloat(locationLan)) * 100000) / 100000);
        }


        /*Insert row and marker*/
        function InsertRow(type) {
            if (type == 0) {
                var rowCountLoc = $('#gridLocation').appendGrid('getRowCount');
                $('#gridLocation').appendGrid('insertRow', 1, rowCountLoc);
                $('#gridLocation').appendGrid('setCtrlValue', 'locLat', rowCountLoc, '13.75');
                $('#gridLocation').appendGrid('setCtrlValue', 'locLon', rowCountLoc, '100.517');
                AddMarkersLoc();
            }
            else if (type == 1) {
                var rowCountSup = $('#gridSupplier').appendGrid('getRowCount');
                $('#gridSupplier').appendGrid('insertRow', 1, rowCountSup);
                //$('#gridSupplier').appendGrid('setCtrlValue', 'supLocation', rowCountSup, '13.75, 100.517');
                $('#gridSupplier').appendGrid('setCtrlValue', 'supLat', rowCountSup, '13.75');
                $('#gridSupplier').appendGrid('setCtrlValue', 'supLon', rowCountSup, '100.517');
                AddMarkersSup();
            }
            else {
                var rowCountCus = $('#gridCustomer').appendGrid('getRowCount');
                $('#gridCustomer').appendGrid('insertRow', 1, rowCountCus);
                //$('#gridCustomer').appendGrid('setCtrlValue', 'cusLocation', rowCountCus, '13.75, 100.517');
                $('#gridCustomer').appendGrid('setCtrlValue', 'cusLat', rowCountCus, '13.75');
                $('#gridCustomer').appendGrid('setCtrlValue', 'cusLon', rowCountCus, '100.517');
                AddMarkersCus();
            }
        }
        /*Delete row for location*/
        function DeleteRowLoc(uniqueIndex) {
            var rowIndex = $('#gridLocation').appendGrid('getRowIndex', uniqueIndex);
            $('#gridLocation').appendGrid('removeRow', rowIndex, uniqueIndex);
        }
        /*Delete row for supplier*/
        function DeleteRowSup(uniqueIndex) {
            var rowIndex = $('#gridSupplier').appendGrid('getRowIndex', uniqueIndex);
            $('#gridSupplier').appendGrid('removeRow', rowIndex, uniqueIndex);
        }
        /*Delete row for customer*/
        function DeleteRowCus(uniqueIndex) {
            var rowIndex = $('#gridCustomer').appendGrid('getRowIndex', uniqueIndex);
            $('#gridCustomer').appendGrid('removeRow', rowIndex, uniqueIndex);
        }

        function DeleteAllRows() {
            var rowCountLoc = $('#gridLocation').appendGrid('getRowCount');
            if (rowCountLoc > 0) {
                for (var i = rowCountLoc - 1; i >= 0; i--) {
                    $('#gridLocation').appendGrid('removeRow', i);
                }
            }

            var rowCountSup = $('#gridSupplier').appendGrid('getRowCount');
            if (rowCountSup > 0) {
                for (var i = rowCountSup - 1; i >= 0; i--) {
                    $('#gridSupplier').appendGrid('removeRow', i);
                }
            }

            var rowCountCus = $('#gridCustomer').appendGrid('getRowCount');
            if (rowCountCus > 0) {
                for (var i = rowCountCus - 1; i >= 0; i--) {
                    $('#gridCustomer').appendGrid('removeRow', i);
                }
            }
        }
    </script>

</head>
<body style="background-color: #F4F4F4">

    <div id="menuBar" style="margin: auto">
        <script>
            $("#menuBar").load("Menubar.htm");
            $("#compareLocation").addClass("current");
        </script>
    </div>

    <section id="secMap" style="margin-right: 5px">
        <div id="myinfo" class="info">
            <p>I am a div on top of a google map .. </p>
        </div>
        <article id="map-canvas"></article>
    </section>

    <section id="secCal" class="ui-accordion ui-widget ui-helper-reset" role="tablist" style="margin-right: 5px">
        <h3 id="ui-accordion-accordion-header-0" class="ui-accordion-header ui-helper-reset ui-state-default 
            ui-corner-all ui-accordion-icons"
            role="tab" aria-controls="ui-accordion-accordion-panel-0"
            aria-selected="true" tabindex="0">
            <a href="#" style="font-weight: bold">สถานที่ตั้ง (Location)</a>
        </h3>
        <article id="ui-accordion-accordion-panel-0" class="ui-accordion-contentCompareLocation ui-helper-reset ui-widget-content 
            ui-corner-bottom ui-accordion-content-active"
            style="display: block; margin-bottom: 5px;"
            aria-labelledby="ui-accordion-accordion-header-0" role="tabpanel" aria-expanded="true" aria-hidden="false">
            <table id="gridLocation"></table>
        </article>

        <h3 id="ui-accordion-accordion-header-1" class="ui-accordion-header ui-helper-reset ui-state-default 
            ui-corner-all ui-accordion-icons"
            role="tab" aria-controls="ui-accordion-accordion-panel-0"
            aria-selected="true" tabindex="0">
            <a href="#" style="font-weight: bold">บริษัทคู่ค้า (Supplier)</a>
        </h3>
        <article id="ui-accordion-accordion-panel-1" class="ui-accordion-contentCompareLocation ui-helper-reset ui-widget-content 
            ui-corner-bottom ui-accordion-content-active"
            style="display: block; margin-bottom: 5px;"
            aria-labelledby="ui-accordion-accordion-header-0" role="tabpanel" aria-expanded="true" aria-hidden="false">
            <table id="gridSupplier"></table>
        </article>

        <h3 id="ui-accordion-accordion-header-2" class="ui-accordion-header ui-helper-reset ui-state-default 
            ui-corner-all ui-accordion-icons"
            role="tab" aria-controls="ui-accordion-accordion-panel-0"
            aria-selected="true" tabindex="0">
            <a href="#" style="font-weight: bold">ลูกค้า (Customer)</a>
        </h3>
        <article id="ui-accordion-accordion-panel-2" class="ui-accordion-contentCompareLocation ui-helper-reset ui-widget-content 
            ui-corner-bottom ui-accordion-content-active"
            style="display: block; margin-bottom: 5px;"
            aria-labelledby="ui-accordion-accordion-header-1" role="tabpanel" aria-expanded="true" aria-hidden="false">
            <table id="gridCustomer"></table>
        </article>

        <section id="button">
            <button id="btnSubmit" onclick="CheckFindLocation();">Find Location</button>
            <button id="btnClear" onclick="DeleteAllMarkers();">Clear</button>
            <input id="hidMarkID" type="hidden" />
        </section>
    </section>
</body>
</html>

